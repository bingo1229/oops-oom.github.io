##   导语

在过去的2022年,**降本增效**几乎成为所有互联网公司的主旋律，从一个程序员的角度来讲，降本增效主要是：提高资源的使用效率、而这里的资源主要是人和机器。



机器的利用率很容易理解，程序员的角度就是优化服务的性能、同样的事情能不能使用更少的机器资源，基础平台的角度提高机器的利用率，公司的角度降低机器成本，这点程序员、基础平台和公司的最终目标是一致的。而人的利用率三者的理解是应该是有偏差的。

程序员的角度： 我能不能花更少的时间完成当前的工作、而腾出时间休息或者做一些更有创造性的工作。

基础平台的角度：这个东西不太容易体现在给老板汇报的ppt中，不像账单那么具体，不容易出成绩。所以为了ppt中数据更好看，别说提高效率，哪怕降低一些效率，好像也是可以理解的。毕竟老板才是决定年终奖的那个。更气人的是，员工是包月的，效率低点，多花点时间就好了，这不也是侧面提高员工的利用率么。

公司的角度应该是：人和机器没必要分开看。



 这里主要想看学习下**Linux**应用开发和部署方式的演进的过程中是如何降本增效的，看看有没有什么借鉴的经验。

## 一道面试题

> 很早之前去某云计算的时候，最后一轮技术面[CDN开发岗]，被问到这么一个问题：
>
> 问：**nginx应该开启多少个进程？**
>
> 答：应该跟cpu的个数保持一致。
>
> 问：**在磁盘操作较多的情况下也是这样么， bla bla bla ...**
>
> 答：哦，对，应该开启更多的进程。

这个事情的本质是在不同场景下如何提高资源利用率，资源不变的情况下服务更多的请求。

使用nginx做代理的时候，开启进程数和cpu个数保持一致，是为了在epoll支持多路复用的情况下，减少进程间context switch带来的额外开销。包括配置**worker_cpu_affinity**也是确保一个进程始终被调度到固定的cpu，从而避免context switch带来的额外开销。

当部分请求存在较多磁盘操作时，假如仍然配置进程数和cpu个数保持一致，就会导致cpu大部分时间都在等待磁盘操作的系统调用完成，同时可能导致没有磁盘操作的请求响应耗时变高[latency]，所以为了提高cpu的利用率,同时优化响应耗时，要开启更多的进程。

当然nginx现在已经支持[thread pool](https://www.nginx.com/blog/thread-pools-boost-performance-9x/)。

进程是计算机编程绕不开的话题，随着所谓c10k, c10m问题的出现，进程有了两个发展方向：协程、容器，与之对应的则是userspace的调度和跨系统的进程的调度。

![goroutine2k8s](http://devops-1255386119.cos.ap-beijing.myqcloud.com/2023-01-04-135103.png)

为什么会出现协程、docker、k8s, 说白了，最终目的都是为了提高机效和人效以及如何在不损失人效的情况下提高机效。

以下主要是从程序员角度的机效和人效，以机效为主线，人效为辅线，说一说编程方式和部署的演进方式。

1.  [提高CPU的利用率.md](https://km.woa.com/articles/show/570644?ts=1675183217) 
1.  [提高物理机的利用率.md](https://km.woa.com/articles/show/570644?ts=1675183217)
1.  提高集群的利用率.md
1. ...待续



---

**[查看原文](https://oops-oom.github.io/posts/%E9%99%8D%E6%9C%AC%E5%A2%9E%E6%95%88-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E7%9A%84%E6%BC%94%E8%BF%9B/%E9%99%8D%E6%9C%AC%E5%A2%9E%E6%95%88-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E9%83%A8%E7%BD%B2%E7%9A%84%E6%BC%94%E8%BF%9B%20-%200%20-%20%E5%AF%BC%E8%AF%AD.html)**
